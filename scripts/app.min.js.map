{"version":3,"sources":["main.js","app.js"],"names":["checkDeferredPrompt","deferredPrompt","$","remove","prompt","userChoice","then","choiceResult","outcome","showMsg","alert","close","message","actionHandler","arguments","length","undefined","actionText","timeout","sb","document","querySelector","MaterialSnackbar","showSnackbar","hideSnackbar","init","ajaxSetup","error","xhr","status","exception","errorReport","setTimeout","location","href","load","getJSON","data_","data","idx","lunr","this","ref","field","forEach","doc","authorHTML","author","map","val","index","mapping","join","affHTML","aff","add","id","title","content","LocalForage","config","driver","INDEXEDDB","name","getItem","err","setItem","fav","addSearchHandler","componentHandler","upgradeAllRegistered","$searchInput","$searchInputLabel","focus","html","blur","keydown","e","colorSeries","colors","textColors","$searchResult","$searchActions","find","searchString","keyCode","preventDefault","result","search","filter","elem","indexOf","parent","MaterialTextfield","change","hasClass","transition","resultIndex","resultEntry","colorIndex","append","click","target","parentElement","currentTarget","toggleClass","on","favIndex","isFav","splice","push","ev","isPC","MaterialTooltip","boundMouseEnterHandler","animation","duration","interval","skipA2HS","clickTab","tabId","window","localforage","test","navigator","userAgent","isLocalhost","Boolean","hostname","match","protocol","serviceWorker","register","registration","onupdatefound","controller","installingWorker","installing","onstatechange","state","reload","Error","console","addEventListener"],"mappings":"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","file":"app.min.js","sourcesContent":["\n'use strict';\n\n\nlet data = null;\nlet idx = null;\nlet errorReport = null;\nlet LocalForage = window.localforage;\nlet fav = [];\nlet isPC = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);\n\nfunction checkDeferredPrompt() {\n  if (deferredPrompt !== null) {\n    $('#installPromptTooltip').remove();\n    deferredPrompt.prompt();\n    deferredPrompt.userChoice.then(function(choiceResult) {\n      if (choiceResult.outcome === 'dismissed') {\n        showMsg('Installation cancelled. You can still manually install by tapping' +\n          ' \"Add to Home Screen\" option in your browser\\'s menu', () => {}, 'OK', 10000);\n      } else {\n        alert('NT18 OnAir successfully installed.');\n        close();\n      }\n    });\n  }\n}\n\nfunction showMsg(message, actionHandler = () => {}, actionText = 'OK', timeout = 3000) {\n  let sb = document.querySelector('#msgContainer').MaterialSnackbar;\n  sb.showSnackbar({\n    message: message,\n    timeout: timeout,\n    actionHandler: () => { actionHandler(); sb.hideSnackbar(); },\n    actionText: actionText\n  });\n}\n\nfunction init() {\n\n  /* Init all components and functions */\n\n  $.ajaxSetup({\n    error: (xhr, status, exception) => {\n      errorReport = `mailto:accel@pku.edu.cn?subject=NT18 OnAir Bug&body=status:${status}; exception:${exception}`;\n      setTimeout(() => {\n        showMsg('Load error', () => {\n          location.href = errorReport;\n        }, 'Report');\n      }, 3000);\n    }\n  });\n\n  $('#home').load('partial/home.html');\n  $('#schedule').load('partial/schedule.html');\n\n  $.getJSON('data/abstracts.json', function (data_) {\n    data = data_;\n    idx = lunr(function () {\n      this.ref('id');\n      this.field('title');\n      this.field('content');\n      this.field('author');\n      data.forEach(function (doc) {\n        doc.authorHTML = doc.author.map((val, index) => `${val}<sup>${doc.mapping[index]}</sup>`).join(', ');\n        doc.affHTML = doc.aff.map((val, index) => `(${index + 1}) ${val}`).join(', ');\n        this.add({\n          id: doc.id,\n          title: doc.title,\n          author: doc.author.join(' ') + ' ' + doc.aff.join(' '),\n          content: doc.content,\n          aff: '',\n          mapping: [] // make WebStorm JSLint know its existence\n        });\n      }, this);\n    });\n  });\n\n  LocalForage.config({ driver: LocalForage.INDEXEDDB, name: 'NT18 OnAir' });\n\n  LocalForage.getItem('favorites', function (err, val) {\n    if (val === null) {\n      LocalForage.setItem('favorites', fav);\n    } else {\n      fav = val;\n    }\n  });\n\n  addSearchHandler();\n\n  componentHandler.upgradeAllRegistered();\n\n}\n\nfunction addSearchHandler() {\n\n  let $searchInput = $('#searchInput');\n  let $searchInputLabel = $('#searchInputLabel');\n  $searchInput.focus(() => {\n\n      $searchInputLabel.html('Search...');\n\n  }).blur(() => {\n\n      if ($searchInput.val() === '')\n        $searchInputLabel.html('Search... or enter \":all\" \":fav\"');\n\n  }).keydown((e) => {\n\n    let colorSeries = ['deep-purple-300', 'deep-purple-400', 'indigo-500', 'indigo-400'];\n    let colors = colorSeries.map((e) => 'mdl-color--' + e);\n    let textColors = colorSeries.map((e) => 'mdl-color-text--' + e);\n    let $searchResult = $('#searchResult');\n    let $searchActions = $('#abstract').find('.mdl-card__actions');\n    let searchString = $searchInput.val();\n\n    if (e.keyCode !== 13) return true;\n    e.preventDefault();\n    $searchResult.html('');\n\n    if (idx === null) {\n      showMsg('Abstracts load error', () => {\n        location.href = errorReport;\n      }, 'Report');\n      return;\n    }\n\n    let result = idx.search((searchString === ':all' || searchString === ':fav') ? '*' : searchString);\n    if (searchString === ':fav') {\n      result = result.filter((elem) => fav.indexOf(elem.ref) > -1);\n    }\n\n    if (result.length === 0) {\n      showMsg('No ' + (searchString === ':fav' ? 'favorites' : 'result'), () => {\n        $searchInput.parent()[0].MaterialTextfield.change('');\n      }, 'Clear Input');\n      if (!$searchActions.hasClass('hidden')) $searchActions.transition('fade out');\n      return;\n    }\n\n    if ($searchActions.hasClass('hidden')) {\n      $searchActions.transition('fade in');\n    }\n\n    result.forEach(function (elem, resultIndex) {\n\n      let resultEntry = data[elem.ref];\n      let authorHTML = resultEntry.authorHTML;\n      let affHTML = resultEntry.affHTML;\n      let colorIndex = resultIndex % colors.length;\n\n      $searchResult.append($(`\n          <div class=\"mdl-card mdl-cell mdl-shadow--2dp result-unit hidden\n                      mdl-cell--12-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone\">\n            <div class=\"mdl-card__title mdl-color-text--white ${colors[colorIndex]}\"\n                 style=\"min-height: 80px;\">\n              <h4 class=\"mdl-card__title-text\" style=\"margin-top: 30px;\">${resultEntry.title}</h4>\n            </div>\n            <div class=\"mdl-card__supporting-text\">\n              <h6 style=\"margin: 12px;\">${authorHTML}</h6><br /><p>${affHTML}</p>\n              <span class=\"resultInnerContent hidden\"><hr />${resultEntry.content}</span>\n            </div>\n            <div class=\"mdl-card__actions\">\n              <div class=\"mdl-button mdl-js-button mdl-js-ripple-effect ${textColors[colorIndex]} toggle-button\"\n                   id=\"toggleButton${resultIndex}\">\n                Toggle Content\n              </div>\n            </div>\n            <button class=\"mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button\" \n                    id=\"favButton${resultIndex}\">\n              <i class=\"material-icons mdl-color-text--white\">\n                ${fav.indexOf(resultEntry.id) > -1 ? 'star' : 'star_border'}\n              </i>\n            </button>\n            <div class=\"mdl-tooltip mdl-tooltip--large mdl-tooltip--left\" id=\"tooltip${resultIndex}\"\n                 data-mdl-for=\"favButton${resultIndex}\" data-mdl-taphold=\"true\">\n              ${fav.indexOf(resultEntry.id) > -1 ? 'Remove from' : 'Add to'} favorites\n            </div>\n          </div>\n        `).click((e) => {\n          if ($(e.target.parentElement).hasClass('toggle-button'))\n            $(e.currentTarget).find('.resultInnerContent').toggleClass('hidden');\n        })\n      );\n\n      $(`#favButton${resultIndex}`)\n        .on('click', function () {\n          let favIndex = fav.indexOf(resultEntry.id);\n          let isFav = favIndex > -1;\n          $(this).find('i').html('star' + (isFav ? '_border' : ''));\n          if (isFav)\n            fav.splice(favIndex, 1);\n          else\n            fav.push(resultEntry.id);\n          $(`#tooltip${resultIndex}`).html(`${isFav ? 'Add to' : 'Remove from'} favorites`);\n          showMsg((isFav ? 'Removed from' : 'Added to') + ' favorites');\n          LocalForage.setItem('favorites', fav);\n        })\n        .on('taphold', (ev) => {\n          if (isPC)\n            $(`#tooltip${resultIndex}`)[0].MaterialTooltip.boundMouseEnterHandler(ev);\n        });\n\n    });\n\n    componentHandler.upgradeAllRegistered();\n\n    $('.result-unit').transition({ animation: 'slide down', duration: 200, interval: 100 });\n\n  });\n\n}\n\nfunction skipA2HS() {\n  $('.mdl__loader.non-standalone').transition('fade out');\n}\n\nfunction clickTab(tabId) {\n  $(tabId).find('span').click();\n}\n","\n/* eslint-env browser */\n\nlet deferredPrompt = null;\n\n(function() {\n  'use strict';\n\n  // Check to make sure service workers are supported in the current browser,\n  // and that the current page is accessed from a secure origin. Using a\n  // service worker from an insecure origin will trigger JS console errors. See\n  // http://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features\n  let isLocalhost = Boolean(window.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      window.location.hostname === '[::1]' ||\n      // 127.0.0.1/8 is considered localhost for IPv4.\n      window.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n    );\n\n  if ('serviceWorker' in navigator &&\n      (window.location.protocol === 'https:' || isLocalhost)) {\n    navigator.serviceWorker.register('service-worker.js')\n    .then(function(registration) {\n      // updatefound is fired if service-worker.js changes.\n      registration.onupdatefound = function() {\n        // updatefound is also fired the very first time the SW is installed,\n        // and there's no need to prompt for a reload at that point.\n        // So check here to see if the page is already controlled,\n        // i.e. whether there's an existing service worker.\n        if (navigator.serviceWorker.controller) {\n          // The updatefound event implies that registration.installing is set:\n          // https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-container-updatefound-event\n          let installingWorker = registration.installing;\n\n          installingWorker.onstatechange = function() {\n            switch (installingWorker.state) {\n              case 'installed':\n                // new content prompt\n                showMsg('New content is available.', () => {\n                  location.reload(true); // true or false doesn't matter?\n                }, 'Reload', 5000);\n                break;\n\n              case 'redundant':\n                throw new Error('The installing ' +\n                                'service worker became redundant.');\n\n              default:\n                // Ignore\n            }\n          };\n        }\n      };\n    }).catch(function(e) {\n      console.error('Error during service worker registration:', e);\n    });\n  }\n\n  window.addEventListener('beforeinstallprompt', function (e) {\n    e.preventDefault();\n    deferredPrompt = e;\n    return false;\n  });\n\n  $(init);\n\n})();\n"]}