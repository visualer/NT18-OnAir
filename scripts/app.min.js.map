{"version":3,"sources":["main.js","app.js"],"names":["showMsg","message","actionHandler","actionText","sb","document","querySelector","MaterialSnackbar","showSnackbar","timeout","init","$","ajaxSetup","error","xhr","status","exception","errorReport","setTimeout","location","href","getJSON","data_","data","idx","lunr","this","ref","field","forEach","doc","add","id","title","author","join","lab","content","mapping","LocalForage","config","driver","INDEXEDDB","name","getItem","err","val","setItem","fav","addSearchHandler","load","componentHandler","upgradeAllRegistered","colorSeries","colors","map","e","textColors","keydown","$searchResult","$searchInput","$searchActions","find","keyCode","preventDefault","html","result","search","length","hasClass","transition","elem","resultIndex","resultJson","authors","authorName","index","labs","labName","colorIndex","append","indexOf","click","$target","target","parentElement","currentTarget","toggleClass","favIndex","isFav","splice","push","animation","duration","interval","skipA2HS","window","localforage","isLocalhost","Boolean","hostname","match","navigator","protocol","serviceWorker","register","then","registration","onupdatefound","controller","installingWorker","installing","onstatechange","state","Error","console"],"mappings":"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","file":"app.min.js","sourcesContent":["\n'use strict';\n\nlet data = null;\nlet idx = null;\nlet errorReport = null;\nlet LocalForage = window.localforage;\nlet fav = [];\n\nfunction showMsg(message, actionHandler, actionText) {\n  let sb = document.querySelector('#msgContainer');\n  sb.MaterialSnackbar.showSnackbar({\n    message: message,\n    timeout: 3000,\n    actionHandler: actionHandler,\n    actionText: actionText\n  });\n}\n\nfunction init() {\n\n  /* Init all components and functions */\n\n  $.ajaxSetup({\n    error: (xhr, status, exception) => {\n      errorReport = `mailto:accel@pku.edu.cn?subject=NT18 OnAir Bug&body=status:${status}; exception:${exception}`;\n      setTimeout(() => {\n        showMsg('Load error', () => {\n          location.href = errorReport;\n        }, 'Report');\n      }, 3000);\n    }\n  });\n\n  $.getJSON('data/abstracts.json', function (data_) {\n    data = data_;\n    idx = lunr(function () {\n      this.ref('id');\n      this.field('title');\n      this.field('lab');\n      this.field('content');\n      this.field('author');\n      data.forEach(function (doc) {\n        this.add({\n          id: doc.id,\n          title: doc.title,\n          author: doc.author.join(' '),\n          lab: doc.lab.join(' '),\n          content: doc.content,\n          mapping: doc.mapping\n        });\n      }, this);\n    });\n  });\n\n  LocalForage.config({\n    driver: LocalForage.INDEXEDDB,\n    name: 'NT18 OnAir'\n  });\n\n  LocalForage.getItem('favorites', function (err, val) {\n    if (val === null) {\n      LocalForage.setItem('favorites', fav);\n    } else {\n      fav = val;\n    }\n  });\n\n  // abstract tab\n\n  addSearchHandler();\n\n  // schedule tab\n\n  $(\"#schedule\").load('partial/schedule.html');\n\n  componentHandler.upgradeAllRegistered();\n\n}\n\n\nfunction addSearchHandler() {\n\n  let colorSeries = ['deep-purple-300', 'deep-purple-400', 'indigo-500', 'indigo-400'];\n  let colors = colorSeries.map((e) => 'mdl-color--' + e);\n  let textColors = colorSeries.map((e) => 'mdl-color-text--' + e);\n\n  $('#searchInput').keydown((e) => {\n\n    let $searchResult = $('#searchResult');\n    let $searchInput = $('#searchInput');\n    let $searchActions = $('#abstract').find('.mdl-card__actions');\n\n    if (e.keyCode !== 13) return true;\n    e.preventDefault();\n\n    if (idx === null) {\n      showMsg('Abstracts load error', () => {\n        location.href = errorReport;\n      }, 'Report');\n      return;\n    }\n\n    $searchResult.html('');\n\n    let result = idx.search($searchInput.val());\n    if (result.length === 0) {\n      showMsg('No result', () => {\n        $searchInput.val('');\n      }, 'Clear Input');\n      if (!$searchActions.hasClass('hidden')) $searchActions.transition('fade out');\n      return;\n    }\n    if ($searchActions.hasClass('hidden')) $searchActions.transition('fade in');\n\n    result.forEach(function (elem, resultIndex) {\n\n      let resultJson = data[elem.ref];\n      let authors = resultJson.author\n        .map((authorName, index) => `${authorName}<sup>${resultJson.mapping[index]}</sup>`).join(', ');\n      let labs = resultJson.lab\n        .map((labName, index) => `(${index + 1}) ${labName}`).join(', ');\n      let colorIndex = resultIndex % colors.length;\n\n      $searchResult.append($(`\n          <div class=\"mdl-card mdl-cell mdl-shadow--2dp result-units hidden\n                      mdl-cell--12-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone\"\n               data-article-id=\"${resultJson.id}\">\n            <div class=\"mdl-card__title mdl-color-text--white ${colors[colorIndex]}\"\n                 style=\"min-height: 80px;\">\n              <h4 class=\"mdl-card__title-text\" style=\"margin-top: 30px;\">${resultJson.title}</h4>\n            </div>\n            <div class=\"mdl-card__supporting-text\">\n              <h6 style=\"margin: 12px;\">${authors}</h6><br /><p>${labs}</p>\n              <span class=\"resultInnerContent hidden\"><hr />${resultJson.content}</span>\n            </div>\n            <div class=\"mdl-card__actions\">\n              <div class=\"mdl-button mdl-js-button mdl-js-ripple-effect ${textColors[colorIndex]} toggle-button\">\n                Toggle Content\n              </div>\n            </div>\n            <button class=\"mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button\">\n              <i class=\"material-icons mdl-color-text--white\">\n                ${fav.indexOf(resultJson.id) > -1 ? 'star' : 'star_border'}\n              </i>\n            </button>\n          </div>\n        `).click((e) => {\n          let $target = $(e.target.parentElement);\n          if ($target.hasClass('toggle-button')) {\n            $(e.currentTarget).find('.resultInnerContent').toggleClass('hidden');\n          } else if ($target.hasClass('fav-button')) {\n            let favIndex = fav.indexOf(resultJson.id);\n            let isFav = favIndex > -1;\n            $target.find('i').html('star' + (isFav ? '_border' : ''));\n            if (isFav) fav.splice(favIndex, 1); else fav.push(resultJson.id);\n            showMsg((isFav ? 'Removed from' : 'Added to') + ' favorites', null, null);\n            LocalForage.setItem('favorites', fav);\n          }\n        })\n      );\n    });\n\n    componentHandler.upgradeAllRegistered();\n\n    $(\".result-units\").transition({ animation: 'slide down', duration: 200, interval: 100 });\n\n  });\n\n}\n\nfunction skipA2HS() {\n\n  $('.mdl__loader.non-standalone').transition('fade out');\n\n}\n","\n/* eslint-env browser */\n(function() {\n  'use strict';\n\n  // Check to make sure service workers are supported in the current browser,\n  // and that the current page is accessed from a secure origin. Using a\n  // service worker from an insecure origin will trigger JS console errors. See\n  // http://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features\n  let isLocalhost = Boolean(window.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      window.location.hostname === '[::1]' ||\n      // 127.0.0.1/8 is considered localhost for IPv4.\n      window.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n    );\n\n  if ('serviceWorker' in navigator &&\n      (window.location.protocol === 'https:' || isLocalhost)) {\n    navigator.serviceWorker.register('service-worker.js')\n    .then(function(registration) {\n      // updatefound is fired if service-worker.js changes.\n      registration.onupdatefound = function() {\n        // updatefound is also fired the very first time the SW is installed,\n        // and there's no need to prompt for a reload at that point.\n        // So check here to see if the page is already controlled,\n        // i.e. whether there's an existing service worker.\n        if (navigator.serviceWorker.controller) {\n          // The updatefound event implies that registration.installing is set:\n          // https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-container-updatefound-event\n          let installingWorker = registration.installing;\n\n          installingWorker.onstatechange = function() {\n            switch (installingWorker.state) {\n              case 'installed':\n\n                $('.newContentPrompt').transition('slide down');\n\n                break;\n\n              case 'redundant':\n                throw new Error('The installing ' +\n                                'service worker became redundant.');\n\n              default:\n                // Ignore\n            }\n          };\n        }\n      };\n    }).catch(function(e) {\n      console.error('Error during service worker registration:', e);\n    });\n  }\n\n  $(init);\n\n})();\n"]}