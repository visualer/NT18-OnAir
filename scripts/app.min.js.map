{"version":3,"sources":["functions.js","main.js","app.js"],"names":["shuffle","array","currentIndex","length","temporaryValue","randomIndex","Math","floor","random","checkDeferredPrompt","deferredPrompt","$","remove","prompt","userChoice","then","choiceResult","outcome","showMsg","alert","message","actionHandler","arguments","undefined","actionText","timeout","sb","MaterialSnackbar","showSnackbar","hideSnackbar","init","ajaxSetup","error","xhr","status","exception","errorReport","setTimeout","location","href","getJSON","data_","data","idx","lunr","Index","load","LocalForage","config","driver","INDEXEDDB","WEBSQL","LOCALSTORAGE","name","getItem","err","val","setItem","fav","addSearchHandler","componentHandler","upgradeAllRegistered","$searchInput","$searchInputLabel","focus","html","blur","keydown","e","$searchResult","$searchActions","find","searchString","keyCode","preventDefault","result","search","filter","elem","indexOf","ref","id","parent","MaterialTextfield","change","hasClass","transition","categories","map","splice","forEach","resultIndex","append","generateResultTemplate","animation","duration","interval","colorSeries","colors","textColors","resultEntry","colorIndex","corrIsFirst","authorHTML","author","index","corr_name","join","title","first_email","affl","corr_email","content","category","poster_num","click","$target","target","parentElement","$currTarget","currentTarget","currArticleId","attr","toggleClass","favIndex","isFav","push","taphold","isMobile","MaterialTooltip","boundMouseEnterHandler","skipA2HS","clickTab","tabId","window","localforage","test","navigator","userAgent","isLocalhost","Boolean","hostname","match","protocol","serviceWorker","register","registration","onupdatefound","controller","installingWorker","installing","onstatechange","state","reload","Error","console","addEventListener"],"mappings":"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","file":"app.min.js","sourcesContent":["'use strict';\n\n// http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\nfunction shuffle(array) {\n  let currentIndex = array.length\n    , temporaryValue\n    , randomIndex\n  ;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = array[currentIndex];\n    array[currentIndex] = array[randomIndex];\n    array[randomIndex] = temporaryValue;\n  }\n\n  return array;\n}\n","\n'use strict';\n\n\nlet data = null;\nlet idx = null;\nlet errorReport = null;\nlet LocalForage = window.localforage;\nlet fav = [];\nlet isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);\nconst categories = ['A1', 'A2', 'A3', 'A4', 'S1', 'S2', 'S3', 'S4', 'C1', 'C2', 'I', 'O'];\n\nfunction checkDeferredPrompt() {\n  if (deferredPrompt !== null) {\n    $('#installPromptTooltip').remove();\n    deferredPrompt.prompt();\n    deferredPrompt.userChoice.then(function(choiceResult) {\n      if (choiceResult.outcome === 'dismissed') {\n        showMsg('Installation cancelled. You can still manually install by tapping' +\n          ' \"Add to Home Screen\" option in your browser\\'s menu.', () => {}, 'OK', 10000);\n      } else {\n        alert('NT18 OnAir successfully installed.');\n      }\n    });\n  }\n}\n\nfunction showMsg(message, actionHandler = () => {}, actionText = 'OK', timeout = 3000) {\n  let sb = $('#msgContainer')[0].MaterialSnackbar;\n  sb.showSnackbar({\n    message: message,\n    timeout: timeout,\n    actionHandler: () => { actionHandler(); sb.hideSnackbar(); },\n    actionText: actionText\n  });\n}\n\nfunction init() {\n\n  /* Init all components and functions */\n\n  $.ajaxSetup({\n    error: (xhr, status, exception) => {\n      errorReport = `mailto:accel@pku.edu.cn?subject=NT18 OnAir Bug&body=status:${status}; exception:${exception}`;\n      setTimeout(() => {\n        showMsg('Load error.', () => {\n          location.href = errorReport;\n        }, 'Report');\n      }, 3000);\n    }\n  });\n\n  $.getJSON('data/abstracts.json', function (data_) {\n    data = data_;\n  });\n\n  $.getJSON('data/abstracts-indexed.json', function (data_) {\n    idx = lunr.Index.load(data_);\n  });\n\n  LocalForage.config({\n    driver: [LocalForage.INDEXEDDB, LocalForage.WEBSQL, LocalForage.LOCALSTORAGE],\n    name: 'NT18 OnAir'\n  });\n\n  LocalForage.getItem('favorites', function (err, val) {\n    if (val === null) {\n      LocalForage.setItem('favorites', fav);\n    } else {\n      fav = val;\n    }\n  });\n\n  addSearchHandler();\n\n  componentHandler.upgradeAllRegistered();\n\n}\n\nfunction addSearchHandler() {\n\n  let $searchInput = $('#searchInput');\n  let $searchInputLabel = $('#searchInputLabel');\n\n  $searchInput.focus(() => {\n      $searchInputLabel.html('Search...');\n  }).blur(() => {\n      if ($searchInput.val() === '')\n        $searchInputLabel.html('Search... or enter \":fav\"');\n  }).keydown((e) => {\n    let $searchResult = $('#searchResult');\n    let $searchActions = $('#abstract').find('.mdl-card__actions');\n    let searchString = $searchInput.val();\n\n    if (e.keyCode !== 13) return true;\n    e.preventDefault();\n    $searchResult.html('');\n\n    if (idx === null) {\n      showMsg('Abstracts load error.', () => {\n        location.href = errorReport;\n      }, 'Report');\n      return;\n    }\n\n    let result = idx.search((searchString === '' || searchString === ':fav') ? '*' : searchString);\n    if (searchString === ':fav') {\n      result = result.filter((elem) => fav.indexOf(data[elem.ref].id) > -1);\n    }\n\n    if (result.length === 0) {\n      showMsg(`No ${searchString === ':fav' ? 'favorites' : 'result'}.`, () => {\n        $searchInput.parent()[0].MaterialTextfield.change('');\n      }, 'Clear Input');\n      if (!$searchActions.hasClass('hidden')) $searchActions.transition('fade out');\n      return;\n    }\n\n    if (result.length > 30) {\n      if (categories.map((e) => `category:${e}`).indexOf(searchString) > -1) {\n        showMsg(`Showing this category\\'s random 60 results.`);\n        shuffle(result);\n      } else if (searchString === '' || searchString === '*') {\n        showMsg(`Showing random 60 results.`);\n        shuffle(result);\n      } else {\n        showMsg(`Showing only the first 60 results.`);\n      }\n      result.splice(60);\n    }\n\n    if ($searchActions.hasClass('hidden')) {\n      $searchActions.transition('fade in');\n    }\n\n    result.forEach((elem, resultIndex) => {\n      $searchResult.append(generateResultTemplate(elem, resultIndex));\n    });\n\n    componentHandler.upgradeAllRegistered();\n\n    $('.result-unit').transition({ animation: 'fade in', duration: 300, interval: 100 });\n\n    $searchInput.blur();\n\n  });\n\n}\n\n\nfunction generateResultTemplate(elem, resultIndex) {\n\n  let colorSeries = ['deep-purple-300', 'deep-purple-400', 'indigo-500', 'indigo-400'];\n  let colors = colorSeries.map((e) => 'mdl-color--' + e);\n  let textColors = colorSeries.map((e) => 'mdl-color-text--' + e);\n\n  let resultEntry = data[elem.ref];\n  let colorIndex = resultIndex % colors.length;\n\n  /* [\"id\", \"poster_num\", \"category\", \"title\", \"type\", \"affl\", \"author\",\n  \"dept\", \"first_email\", \"corr_name\", \"corr_email\", \"content\"]*/\n  let corrIsFirst; // whether correlating author is presenting author\n  let authorHTML = resultEntry.author.map((val, index) => {\n    if (val === resultEntry.corr_name) {\n      corrIsFirst = (index === 0);\n      return `${val}*`;\n    }\n    else return val;\n  });\n  authorHTML[0] += '<sup>&ddagger;</sup>';\n  authorHTML = authorHTML.join('; ');\n\n  return $(`\n          <div class=\"mdl-card mdl-cell mdl-shadow--2dp result-unit hidden\n                      mdl-cell--6-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone\"\n               data-article-id=\"${resultEntry.id}\" data-result-id=\"${resultIndex}\">\n            <div class=\"mdl-card__title mdl-color-text--white ${colors[colorIndex]}\"\n                 style=\"min-height: 80px;\">\n              <h4 class=\"mdl-card__title-text\" style=\"margin-top: 30px;\">${resultEntry.title}</h4>\n            </div>\n            <div class=\"mdl-card__supporting-text\" style=\"padding: 0px 20px;\">\n              <span class=\"result-content hidden\">\n                <h6 style=\"margin: 8px;\">${authorHTML}</h6>\n                <p style=\"margin-bottom: 6px;\">\n                  ${corrIsFirst ? '*' : ''}<sup>&ddagger;</sup>\n                  Presenting${corrIsFirst ? ' and corresponding' : ''}:\n                  ${resultEntry.first_email}, ${resultEntry.affl}\n                </p>\n                ${corrIsFirst ? '' : `<p>* Corresponding: ${resultEntry.corr_email}</p>`}\n                <hr />${resultEntry.content}\n              </span>\n            </div>\n            <div class=\"mdl-card__actions\">\n              <div class=\"mdl-button mdl-js-button mdl-js-ripple-effect ${textColors[colorIndex]} toggle-button\">\n                Toggle Details\n              </div>\n            </div>\n            <div class=\"category-info\">\n              <p>${resultEntry.category}: ${resultEntry.poster_num}</p>\n            </div>\n            <button class=\"mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button\" \n                    id=\"favButton${resultIndex}\">\n              <i class=\"material-icons mdl-color-text--white fav-icon\">\n                ${fav.indexOf(resultEntry.id) > -1 ? 'star' : 'star_border'}\n              </i>\n            </button>\n            <div class=\"mdl-tooltip mdl-tooltip--large mdl-tooltip--left\"\n                 data-mdl-for=\"favButton${resultIndex}\" data-mdl-taphold=\"true\">\n              ${fav.indexOf(resultEntry.id) > -1 ? 'Remove from' : 'Add to'} favorites\n            </div>\n          </div>\n        `).click((e) => {\n          let $target = $(e.target.parentElement);\n          let $currTarget = $(e.currentTarget);\n          let currArticleId = $currTarget.attr('data-article-id');\n\n          if ($target.hasClass('toggle-button')) {\n            $currTarget.find('.result-content').toggleClass('hidden');\n            return false;\n          }\n          else if ($target.hasClass('fav-button')) {\n            let favIndex = fav.indexOf(currArticleId);\n            let isFav = favIndex > -1;\n            $currTarget.find('.fav-icon').html(`star${isFav ? '_border' : ''}`);\n            if (isFav)\n              fav.splice(favIndex, 1);\n            else\n              fav.push(currArticleId);\n            $currTarget.find('.mdl-tooltip').html(`${isFav ? 'Add to' : 'Remove from'} favorites`);\n            showMsg(`${isFav ? 'Removed from' : 'Added to'} favorites.`);\n            LocalForage.setItem('favorites', fav);\n            return false;\n          }\n        }).taphold((e) => {\n          if ($(e.target.parentElement).hasClass('fav-button') && isMobile)\n            $(e.currentTarget).find('.mdl-tooltip')[0].MaterialTooltip.boundMouseEnterHandler(e);\n          return false;\n        });\n}\n\nfunction skipA2HS() {\n  $('.mdl__loader.non-standalone').transition('fade out');\n}\n\nfunction clickTab(tabId) {\n  $(tabId).find('span').click();\n}\n","\n/* eslint-env browser */\n\nlet deferredPrompt = null;\n\n(function() {\n  'use strict';\n\n  // Check to make sure service workers are supported in the current browser,\n  // and that the current page is accessed from a secure origin. Using a\n  // service worker from an insecure origin will trigger JS console errors. See\n  // http://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features\n  let isLocalhost = Boolean(window.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      window.location.hostname === '[::1]' ||\n      // 127.0.0.1/8 is considered localhost for IPv4.\n      window.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n    );\n\n  if ('serviceWorker' in navigator &&\n      (window.location.protocol === 'https:' || isLocalhost)) {\n    navigator.serviceWorker.register('service-worker.js')\n    .then(function(registration) {\n      // updatefound is fired if service-worker.js changes.\n      registration.onupdatefound = function() {\n        // updatefound is also fired the very first time the SW is installed,\n        // and there's no need to prompt for a reload at that point.\n        // So check here to see if the page is already controlled,\n        // i.e. whether there's an existing service worker.\n        if (navigator.serviceWorker.controller) {\n          // The updatefound event implies that registration.installing is set:\n          // https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-container-updatefound-event\n          let installingWorker = registration.installing;\n\n          installingWorker.onstatechange = function() {\n            switch (installingWorker.state) {\n              case 'installed':\n                // new content prompt\n                showMsg('New content is available.', () => {\n                  location.reload(true); // true or false doesn't matter?\n                }, 'Reload', 5000);\n                break;\n\n              case 'redundant':\n                throw new Error('The installing ' +\n                                'service worker became redundant.');\n\n              default:\n                // Ignore\n            }\n          };\n        }\n      };\n    }).catch(function(e) {\n      console.error('Error during service worker registration:', e);\n    });\n  }\n\n  window.addEventListener('beforeinstallprompt', function (e) {\n    e.preventDefault();\n    deferredPrompt = e;\n    return false;\n  });\n\n  $(init);\n\n})();\n"]}