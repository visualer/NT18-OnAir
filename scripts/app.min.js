"use strict";function addSearchHandler(){var p=$("#searchInput");p.keydown(function(t){if(13!==t.keyCode)return!0;t.preventDefault();var e=$("#searchResult"),n=$("#abstract").find(".mdl-card__actions"),a=validateSearchString(),o=function(t){p.parent()[0].MaterialTextfield.change(t)};if(o(a),e.html(""),null!==idx){var r=[];try{r=idx.search(""===a?"*":a.split(" ").map(function(t){return"-"===t[0]?t:"+"+t}).join(" "))}catch(t){return showMsg("Unrecognized input.",function(){return o("")},"Clear Input"),void(n.hasClass("hidden")||n.transition("fade out"))}var i="1"===$("#favFilterButton").attr("data-fav-filter-state");if(i&&(r=r.filter(function(t){return-1<fav.indexOf(data[t.ref].id)})),0===r.length)return i?showMsg("No favorites found."):showMsg("No results found.",function(){o("")},"Clear Input"),void(n.hasClass("hidden")||n.transition("fade out"));var l=Math.ceil(r.length/14),d=1,s=$("#searchActionPrev"),c=$("#searchActionNext"),u=function(){e.html(""),s.attr("disabled",1===d?"disabled":null),c.attr("disabled",d===l?"disabled":null),$("#searchActionPageNum").html(d+" / "+l),r.slice(14*(d-1),14*d).forEach(function(t){e.append(generateResultTemplate(t))}),componentHandler.upgradeAllRegistered()};u(),s.click(function(){d-=1,u(),doHighlight()}),c.click(function(){d+=1,u(),doHighlight()}),componentHandler.upgradeAllRegistered(),n.hasClass("hidden")&&n.transition("fade in"),p.blur(),window.prevSearchHighlight=a.split(" ").map(function(t){return"-"===t[0]?"":("+"===t[0]&&(t=t.substring(1)),"category:"===t.substring(0,9)||"session:"===t.substring(0,8)?"":t.substring(t.indexOf(":")+1))}),doHighlight()}else showMsg("Abstracts load error.",function(){location.href=errorReport},"Report")})}function generateResultTemplate(t){var n=data[t.ref],e=n.poster_num,a="SC".includes(e[1])?0:1,o=["","July 17<sup>th</sup> 16:00","July 18<sup>th</sup> 11:00","July 19<sup>th</sup> 11:00","July 19<sup>th</sup> 16:00"][2*(1+a)-parseInt(e.slice(2,5))%2],r=n.author.map(function(t,e){return t!==(n.corr_name||t)?0!==e?t:"<u>"+t+"</u>":(0!==e?t:"<u>"+t+"</u>")+"*"}).join(", ");return $('\n          <div class="mdl-card mdl-cell mdl-shadow--2dp result-unit\n                      mdl-cell--6-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone"\n               data-article-id="'+n.id+'" data-result-id="'+n.id+'">\n            <div class="mdl-card__title mdl-color-text--white mdl-button-2 mdl-js-button\n                        mdl-js-ripple-effect '+["mdl-color--deep-purple-400","mdl-color--blue-900"][a]+' toggle-button"\n                 style="min-height: 80px;">\n              <h4 class="mdl-card__title-text" style="margin-top: 30px; font-size: 20px;">'+n.title+'</h4>\n            </div>\n            <div class="mdl-card__supporting-text hidden" style="padding-top: 0; padding-bottom: 0;">\n              <h6 style="margin: 8px;">'+(n.authorHTML||r)+"</h6>\n              <p>\n                *Corresponding: \n                "+(""===n.corr_email?"":n.corr_email+", ")+n.affl+'\n              </p>\n              <hr /><p style="line-height: 18px;">'+n.content+'</p>\n            </div>\n            <div class="category-info">\n              <p>'+n.category+": "+e+", "+o+'</p>\n            </div>\n            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button" \n                    id="favButton'+n.id+'">\n              <i class="material-icons mdl-color-text--white fav-icon">\n                '+(-1<fav.indexOf(n.id)?"star":"star_border")+'\n              </i>\n            </button>\n            <div class="mdl-tooltip mdl-tooltip--large mdl-tooltip--left"\n                 data-mdl-for="favButton'+n.id+'" data-mdl-taphold="true">\n              '+(-1<fav.indexOf(n.id)?"Remove from":"Add to")+" favorites\n            </div>\n          </div>\n        ").click(function(t){var e=$(t.target.parentElement),n=$(t.currentTarget),a=n.attr("data-article-id");if(e.hasClass("toggle-button"))return n.find(".mdl-card__supporting-text").transition({animation:"fade",queue:!1}),!1;if(e.hasClass("fav-button")){var o=fav.indexOf(a),r=-1<o;return n.find(".fav-icon").html("star"+(r?"_border":"")),r?fav.splice(o,1):fav.push(a),n.find(".mdl-tooltip").html((r?"Add to":"Remove from")+" favorites"),showMsg((r?"Removed from":"Added to")+" favorites."),window.localforage.setItem("favorites",fav),!1}}).taphold(function(t){$(t.target.parentElement).hasClass("fav-button")&&isMobile&&$(t.currentTarget).find(".mdl-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(t)})}function loadPartial(){$("#home-partial").load("data/home-partial.html",function(){componentHandler.upgradeAllRegistered(),$("#forceReloadButton").click(function(){var t=performance.now();console.log(t),600<t-forceReloadTap0?forceReloadTap0=t:600<t-forceReloadTap1?forceReloadTap1=t:location.reload(!0)})}),$("#topics").load("data/topics-partial.html",function(){componentHandler.upgradeAllRegistered(),$("#topics").find(".mdl-button__ripple-container").click(function(){var t=$(this),e=t.parent(),n=e.nextAll(),a=t.prev().children(":first");if(!e[0].hasAttribute("data-expansion")){if(!e[0].hasAttribute("data-category"))return!1;clickTab("#tabAbstract");var o=$("#searchInput"),r=validateSearchString().split(" "),i=r.findIndex(function(t){return"category:"===t.slice(0,9)});return-1<i&&r.splice(i,1),o.parent()[0].MaterialTextfield.change(r.join(" ")+" category:"+e.attr("data-category")),o.trigger($.Event("keydown",{keyCode:13})),scrollToTop(),!1}toggleArrowRotation(a),n.slice(0,parseInt(e.attr("data-expansion"))).toggleClass("hidden")})}),$("#schedule").load("data/schedule-partial.html",function(){window.swiperObj=new Swiper(".swiper-container",{autoHeight:!0,spaceBetween:70,roundLengths:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),$("#tabSchedule").one("click",".mdl-layout__tab-ripple-container",function(){window.swiperObj.update()}),componentHandler.upgradeAllRegistered(),$("#schedule").find(".mdl-button__ripple-container").click(function(){var t=$(this),e=t.parent(),n=e.next(),a=t.prev().children(":first");if(e[0].hasAttribute("data-poster-session-redirect")){clickTab("#tabAbstract");var o=$("#searchInput"),r=validateSearchString().split(" "),i=r.findIndex(function(t){return"session:"===t.slice(0,8)});-1<i&&r.splice(i,1),o.parent()[0].MaterialTextfield.change(r.join(" ")+" session:"+e.attr("data-poster-session-redirect")),o.trigger($.Event("keydown",{keyCode:13})),scrollToTop()}else toggleArrowRotation(a),n.toggleClass("hidden");return!1})})}var data=null,idx=null,errorReport=null,fav=[],isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),isPhone=/Android|iPhone|iPod|BlackBerry/i.test(navigator.userAgent),forceReloadTap0=-1,forceReloadTap1=-1,skipA2HS=function(){$(".mdl__loader.non-standalone").transition("fade out")},clickTab=function(t){$(t).find("span").click(),"#tabSchedule"===t&&window.swiperObj.update()},scrollToTop=function(){$(".mdl-layout").stop().animate({scrollTop:0}),$(".mdl-layout__content").stop().animate({scrollTop:0})},validateSearchString=function(){return $("#searchInput").val().replace(/[^a-zA-Z0-9\-*:]+/gi," ").trim().replace(/\s{2,}/g," ")},doHighlight=function(){"1"===$("#searchActionMark").attr("data-highlight-state")&&$("#searchResult").mark(window.prevSearchHighlight,{exclude:["h4.mdl-card__title-text","div.category-info *"],wildcards:"enabled"})};function checkDeferredPrompt(){null!==deferredPrompt&&($("#installPromptTooltip").remove(),deferredPrompt.prompt(),deferredPrompt.userChoice.then(function(t){"dismissed"===t.outcome?showMsg('Installation cancelled. You can still manually install by tapping "Add to Home Screen" option in your browser\'s menu.',function(){},"OK",1e4):alert("NT18 OnAir successfully installed.")}))}function showMsg(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"OK",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:3e3,o=$("#msgContainer")[0].MaterialSnackbar;o.showSnackbar({message:t,timeout:a,actionHandler:function(){e(),o.hideSnackbar()},actionText:n})}function toggleArrowRotation(e){var t=parseInt(e.attr("data-rotate"))||0;e.attr("data-rotate",1-t),$({deg:180*t}).animate({deg:180*(1-t)},{duration:80,easing:"swing",step:function(t){e.css("transform","rotate("+t+"deg)")}})}function init(){if($.ajaxSetup({error:function(t,e,n){errorReport="mailto:accel@pku.edu.cn?subject=Bug Report&body=status:"+e+"; exception:"+n,setTimeout(function(){showMsg("Load error.",function(){location.href=errorReport},"Report")},3e3)}}),isMobile&&$("head").append("<style>.mdl-button:not(.mdl-button--fab):hover{background:none!important;}</style>"),isPhone){var e=$("#scrollTopButton");$(".mdl-layout__content").scroll(function(){var t=$(this).scrollTop();t<800&&!e.hasClass("hidden")?e.transition("fade out"):800<=t&&e.hasClass("hidden")&&e.transition("fade in")})}loadPartial(),$("#filterButton").click(function(){return clickTab("#tabTopics"),scrollToTop(),!1}).taphold(function(t){isMobile&&$(".filter-button-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(t)}),$("#favFilterButton").click(function(){var t=$("#favFilterButton"),e=1-parseInt(t.attr("data-fav-filter-state"));return t.attr("data-fav-filter-state",e),t.find("i.material-icons").html(1===e?"star":"star_border"),$("#searchInput").trigger($.Event("keydown",{keyCode:13})),!1}).taphold(function(t){isMobile&&$(".fav-filter-button-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(t)}),$("#searchActionMark").click(function(){var t=$("#searchActionMark"),e=$("#searchResult"),n=1-parseInt(t.attr("data-highlight-state"));t.attr("data-highlight-state",n),t.find("i.material-icons").html(1===n?"format_color_reset":"border_color"),doHighlight(),0===n&&e.unmark()}).taphold(function(t){isMobile&&$(".mark-button-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(t)});var n=window.localforage;$.getJSON("data/abstracts.json",function(t){data=t}),$.getJSON("data/abstracts-indexed.json",function(t){idx=lunr.Index.load(t)}),n.config({driver:[n.INDEXEDDB,n.WEBSQL,n.LOCALSTORAGE],name:"NT18 OnAir"}),n.getItem("favorites",function(t,e){null===e?n.setItem("favorites",fav):fav=e}),addSearchHandler(),componentHandler.upgradeAllRegistered()}var deferredPrompt=null;!function(){var t=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&("https:"===window.location.protocol||t)&&navigator.serviceWorker.register("service-worker.js").then(function(e){e.onupdatefound=function(){if(navigator.serviceWorker.controller){var t=e.installing;t.onstatechange=function(){switch(t.state){case"installed":showMsg("New content is available.",function(){location.reload(!0)},"Reload",5e3);break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}}).catch(function(t){console.error("Error during service worker registration:",t)}),window.addEventListener("beforeinstallprompt",function(t){return t.preventDefault(),deferredPrompt=t,!1}),$(init)}();
//# sourceMappingURL=app.min.js.map
