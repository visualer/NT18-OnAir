"use strict";function checkDeferredPrompt(){null!==deferredPrompt&&($("#installPromptTooltip").remove(),deferredPrompt.prompt(),deferredPrompt.userChoice.then(function(t){"dismissed"===t.outcome?showMsg('Installation cancelled. You can still manually install by tapping "Add to Home Screen" option in your browser\'s menu',function(){},"OK",1e4):alert("NT18 OnAir successfully installed.")}))}function showMsg(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3,a=$("#msgContainer")[0].MaterialSnackbar;a.showSnackbar({message:t,timeout:o,actionHandler:function(){e(),a.hideSnackbar()},actionText:n})}function init(){$.ajaxSetup({error:function(t,e,n){errorReport="mailto:accel@pku.edu.cn?subject=NT18 OnAir Bug&body=status:"+e+"; exception:"+n,setTimeout(function(){showMsg("Load error",function(){location.href=errorReport},"Report")},3e3)}}),$("#home").load("partial/home.html"),$("#schedule").load("partial/schedule.html"),$.getJSON("data/abstracts.json",function(t){data=t,idx=lunr(function(){this.ref("id"),this.field("title"),this.field("content"),this.field("author"),data.forEach(function(t){t.authorHTML=t.author.map(function(e,n){return e+"<sup>"+t.mapping[n]+"</sup>"}).join(", "),t.affHTML=t.aff.map(function(t,e){return"("+(e+1)+") "+t}).join(", "),this.add({id:t.id,title:t.title,author:t.author.join(" ")+" "+t.aff.join(" "),content:t.content,aff:"",mapping:[]})},this)})}),LocalForage.config({driver:LocalForage.INDEXEDDB,name:"NT18 OnAir"}),LocalForage.getItem("favorites",function(t,e){null===e?LocalForage.setItem("favorites",fav):fav=e}),addSearchHandler(),componentHandler.upgradeAllRegistered()}function addSearchHandler(){var t=$("#searchInput"),e=$("#searchInputLabel");t.focus(function(){e.html("Search...")}).blur(function(){""===t.val()&&e.html('Search... or enter ":all" ":fav"')}).keydown(function(e){var n=$("#searchResult"),o=$("#abstract").find(".mdl-card__actions"),a=t.val();if(13!==e.keyCode)return!0;if(e.preventDefault(),n.html(""),null===idx)return void showMsg("Abstracts load error",function(){location.href=errorReport},"Report");var r=idx.search(":all"===a||":fav"===a?"*":a);return":fav"===a&&(r=r.filter(function(t){return fav.indexOf(t.ref)>-1})),0===r.length?(showMsg("No "+(":fav"===a?"favorites":"result"),function(){t.parent()[0].MaterialTextfield.change("")},"Clear Input"),void(o.hasClass("hidden")||o.transition("fade out"))):(o.hasClass("hidden")&&o.transition("fade in"),r.forEach(function(t,e){n.append(generateResultTemplate(t,e))}),componentHandler.upgradeAllRegistered(),void $(".result-unit").transition({animation:"slide down",duration:200,interval:100}))})}function generateResultTemplate(t,e){var n=["deep-purple-300","deep-purple-400","indigo-500","indigo-400"],o=n.map(function(t){return"mdl-color--"+t}),a=n.map(function(t){return"mdl-color-text--"+t}),r=data[t.ref],i=e%o.length;return $('\n          <div class="mdl-card mdl-cell mdl-shadow--2dp result-unit hidden\n                      mdl-cell--12-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone"\n               data-article-id="'+r.id+'" data-result-id="'+e+'">\n            <div class="mdl-card__title mdl-color-text--white '+o[i]+'"\n                 style="min-height: 80px;">\n              <h4 class="mdl-card__title-text" style="margin-top: 30px;">'+r.title+'</h4>\n            </div>\n            <div class="mdl-card__supporting-text">\n              <h6 style="margin: 12px;">'+r.authorHTML+"</h6><br /><p>"+r.affHTML+'</p>\n              <span class="result-content hidden"><hr />'+r.content+'</span>\n            </div>\n            <div class="mdl-card__actions">\n              <div class="mdl-button mdl-js-button mdl-js-ripple-effect '+a[i]+' toggle-button">\n                Toggle Content\n              </div>\n            </div>\n            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button" \n                    id="favButton'+e+'">\n              <i class="material-icons mdl-color-text--white fav-icon">\n                '+(fav.indexOf(r.id)>-1?"star":"star_border")+'\n              </i>\n            </button>\n            <div class="mdl-tooltip mdl-tooltip--large mdl-tooltip--left"\n                 data-mdl-for="favButton'+e+'" data-mdl-taphold="true">\n              '+(fav.indexOf(r.id)>-1?"Remove from":"Add to")+" favorites\n            </div>\n          </div>\n        ").click(function(t){var e=$(t.target.parentElement),n=$(t.currentTarget),o=n.attr("data-article-id");if(e.hasClass("toggle-button"))return n.find(".result-content").toggleClass("hidden"),!1;if(e.hasClass("fav-button")){var a=fav.indexOf(o),r=a>-1;return n.find(".fav-icon").html("star"+(r?"_border":"")),r?fav.splice(a,1):fav.push(o),n.find(".mdl-tooltip").html((r?"Add to":"Remove from")+" favorites"),showMsg((r?"Removed from":"Added to")+" favorites"),LocalForage.setItem("favorites",fav),!1}}).taphold(function(t){return $(t.target.parentElement).hasClass("fav-button")&&isMobile&&$(t.currentTarget).find(".mdl-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(t),!1})}function skipA2HS(){$(".mdl__loader.non-standalone").transition("fade out")}function clickTab(t){$(t).find("span").click()}var data=null,idx=null,errorReport=null,LocalForage=window.localforage,fav=[],isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),deferredPrompt=null;!function(){var t=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&("https:"===window.location.protocol||t)&&navigator.serviceWorker.register("service-worker.js").then(function(t){t.onupdatefound=function(){if(navigator.serviceWorker.controller){var e=t.installing;e.onstatechange=function(){switch(e.state){case"installed":showMsg("New content is available.",function(){location.reload(!0)},"Reload",5e3);break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}})["catch"](function(t){console.error("Error during service worker registration:",t)}),window.addEventListener("beforeinstallprompt",function(t){return t.preventDefault(),deferredPrompt=t,!1}),$(init)}();
//# sourceMappingURL=app.min.js.map
