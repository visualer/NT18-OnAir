"use strict";function addSearchHandler(){var c=$("#searchInput"),e=$("#searchInputLabel");c.focus(function(){e.html("Search...")}).blur(function(){""===c.val()&&e.html('Search... or enter ":fav"')}).keydown(function(e){var n=$("#searchResult"),t=$("#abstract").find(".mdl-card__actions"),a=c.val();if(13!==e.keyCode)return!0;if(e.preventDefault(),n.html(""),null!==idx){var o=idx.search(""===a||":fav"===a?"*":a);if(":fav"===a&&(o=o.filter(function(e){return-1<fav.indexOf(data[e.ref].id)})),0===o.length)return showMsg("No "+(":fav"===a?"favorites":"result")+".",function(){c.parent()[0].MaterialTextfield.change("")},"Clear Input"),void(t.hasClass("hidden")||t.transition("fade out"));var r=Math.ceil(o.length/18),i=1,l=$("#searchActionPrev"),d=$("#searchActionNext"),s=function(){n.html(""),1===i?l.attr("disabled","disabled"):l.removeAttr("disabled"),i===r?d.attr("disabled","disabled"):d.removeAttr("disabled"),o.slice(18*(i-1),18*i).forEach(function(e,t){n.append(generateResultTemplate(e,t))}),$("#searchActionPageNum").html(i+" / "+r),componentHandler.upgradeAllRegistered()};s(),l.click(function(){i-=1,s()}),d.click(function(){i+=1,s()}),componentHandler.upgradeAllRegistered(),t.hasClass("hidden")&&t.transition("fade in"),c.blur()}else showMsg("Abstracts load error.",function(){location.href=errorReport},"Report")})}function generateResultTemplate(e,t){var n=["deep-purple-300","deep-purple-400","indigo-500","indigo-400"],a=n.map(function(e){return"mdl-color--"+e}),o=n.map(function(e){return"mdl-color-text--"+e}),r=data[e.ref],i=t%a.length,l=void 0,d=r.author.map(function(e,t){return e===r.corr_name?(l=0===t,e+"*"):e});return d[0]+="<sup>&ddagger;</sup>",d=d.join("; "),$('\n          <div class="mdl-card mdl-cell mdl-shadow--2dp result-unit\n                      mdl-cell--6-col-desktop mdl-cell--8-col-tablet mdl-cell--4-col-phone"\n               data-article-id="'+r.id+'" data-result-id="'+t+'">\n            <div class="mdl-card__title mdl-color-text--white '+a[i]+'"\n                 style="min-height: 80px;">\n              <h4 class="mdl-card__title-text" style="margin-top: 30px; font-size: 20px;">'+r.title+'</h4>\n            </div>\n            <div class="mdl-card__supporting-text" style="padding: 0 20px;">\n              <span class="result-content hidden">\n                <h6 style="margin: 8px;">'+d+'</h6>\n                <p style="margin-bottom: 6px;">\n                  '+(l?"*":"")+"<sup>&ddagger;</sup>\n                  Presenting"+(l?" and corresponding":"")+":\n                  "+r.first_email+", "+r.affl+"\n                </p>\n                "+(l?"":"<p>* Corresponding: "+r.corr_email+"</p>")+'\n                <hr /><p style="line-height: 18px;">'+r.content+'</p>\n              </span>\n            </div>\n            <div class="mdl-card__actions">\n              <div class="mdl-button mdl-js-button mdl-js-ripple-effect '+o[i]+' toggle-button">\n                Toggle Details\n              </div>\n            </div>\n            <div class="category-info">\n              <p>'+r.category+": "+r.poster_num+'</p>\n            </div>\n            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon fav-button" \n                    id="favButton'+t+'">\n              <i class="material-icons mdl-color-text--white fav-icon">\n                '+(-1<fav.indexOf(r.id)?"star":"star_border")+'\n              </i>\n            </button>\n            <div class="mdl-tooltip mdl-tooltip--large mdl-tooltip--left"\n                 data-mdl-for="favButton'+t+'" data-mdl-taphold="true">\n              '+(-1<fav.indexOf(r.id)?"Remove from":"Add to")+" favorites\n            </div>\n          </div>\n        ").click(function(e){var t=$(e.target.parentElement),n=$(e.currentTarget),a=n.attr("data-article-id");if(t.hasClass("toggle-button"))return n.find(".result-content").toggleClass("hidden"),!1;if(t.hasClass("fav-button")){var o=fav.indexOf(a),r=-1<o;return n.find(".fav-icon").html("star"+(r?"_border":"")),r?fav.splice(o,1):fav.push(a),n.find(".mdl-tooltip").html((r?"Add to":"Remove from")+" favorites"),showMsg((r?"Removed from":"Added to")+" favorites."),LocalForage.setItem("favorites",fav),!1}}).taphold(function(e){return $(e.target.parentElement).hasClass("fav-button")&&isMobile&&$(e.currentTarget).find(".mdl-tooltip")[0].MaterialTooltip.boundMouseEnterHandler(e),!1})}var data=null,idx=null,errorReport=null,LocalForage=window.localforage,fav=[],isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent),categories=["A1","A2","A3","A4","S1","S2","S3","S4","C1","C2","I","O"],skipA2HS=function(){$(".mdl__loader.non-standalone").transition("fade out")},clickTab=function(e){$(e).find("span").click()};function checkDeferredPrompt(){null!==deferredPrompt&&($("#installPromptTooltip").remove(),deferredPrompt.prompt(),deferredPrompt.userChoice.then(function(e){"dismissed"===e.outcome?showMsg('Installation cancelled. You can still manually install by tapping "Add to Home Screen" option in your browser\'s menu.',function(){},"OK",1e4):alert("NT18 OnAir successfully installed.")}))}function showMsg(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"OK",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:3e3,o=$("#msgContainer")[0].MaterialSnackbar;o.showSnackbar({message:e,timeout:a,actionHandler:function(){t(),o.hideSnackbar()},actionText:n})}function init(){$.ajaxSetup({error:function(e,t,n){errorReport="mailto:accel@pku.edu.cn?subject=NT18 OnAir Bug&body=status:"+t+"; exception:"+n,setTimeout(function(){showMsg("Load error.",function(){location.href=errorReport},"Report")},3e3)}}),$("#home-partial").load("partial/home-partial.html"),$("#schedule").load("partial/schedule-partial.html"),$.getJSON("data/abstracts.json",function(e){data=e}),$.getJSON("data/abstracts-indexed.json",function(e){idx=lunr.Index.load(e)}),LocalForage.config({driver:[LocalForage.INDEXEDDB,LocalForage.WEBSQL,LocalForage.LOCALSTORAGE],name:"NT18 OnAir"}),LocalForage.getItem("favorites",function(e,t){null===t?LocalForage.setItem("favorites",fav):fav=t}),addSearchHandler(),componentHandler.upgradeAllRegistered()}var deferredPrompt=null;!function(){var e=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&("https:"===window.location.protocol||e)&&navigator.serviceWorker.register("service-worker.js").then(function(t){t.onupdatefound=function(){if(navigator.serviceWorker.controller){var e=t.installing;e.onstatechange=function(){switch(e.state){case"installed":showMsg("New content is available.",function(){location.reload(!0)},"Reload",5e3);break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}}).catch(function(e){console.error("Error during service worker registration:",e)}),window.addEventListener("beforeinstallprompt",function(e){return e.preventDefault(),deferredPrompt=e,!1}),$(init)}();
//# sourceMappingURL=app.min.js.map
